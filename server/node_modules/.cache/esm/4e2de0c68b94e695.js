let Account,Room,Invite,cloudinary;_8b9‍.x([["searchUser",()=>searchUser],["uploadImage",()=>uploadImage],["getUser",()=>getUser],["inviteUser",()=>inviteUser]]);_8b9‍.w("../models/user",[["default",["Account","Room","Invite"],function(v){Account=Room=Invite=v}]]);_8b9‍.w("cloudinary",[["default",["cloudinary"],function(v){cloudinary=v}]]);



const mongoose = require("mongoose")

cloudinary.config({
  cloud_name: process.env.CLOUDINARY_NAME,
  api_key: process.env.CLOUDINARY_KEY,
  api_secret: process.env.CLOUDINARY_SECRET,
})
       async function searchUser(req,res){
  const {query} = req.params;
    // Checking if query is given
    if (!query) return res.send({message:"no query"});
  try{
    const user = await Account.find({
      $and: [
        {"landlord": false},
        {$or: [
          {"name": {$regex: query, $options: '/i'}},
          {"email": {$regex: query, $options: '/i'}}
        ]}
      ]
    }).limit(10).select('_id email name ');
    res.send({success:true, user});

  } catch(err){
    _8b9‍.g.console.log(err);
    res.send({success: false, message: "Error in search user function"})
  }
}

       async function uploadImage(req,res){
  try{
    const result = await cloudinary.uploader.upload(req.files.image.path);
    _8b9‍.g.console.log("uploaded image url: ", result );
    res.send({url: result.secure_url, //https
              public_id: result.public_id,            
  })
  } catch(err){
    _8b9‍.g.console.log(err)
  }
}
       async function getUser(req,res){
  try{
    const user =  await Account.findOne({_id: req.params.id}).select('-password -secret -secretQuestion -roommates -rentCollected -rentPaid -rent')
    // console.log("User found: ", user);
    res.send({success:true, user})
  } catch(err){
    _8b9‍.g.console.log(err);
  }
}

       async function inviteUser(req,res){
  const {sender_id, roomKey,rent,address} = req.body;
  // console.log("sender id: ", sender_id)
  try{
    // const room = new Room({
    //   key: roomKey,
    //   rent: rent,
    //   address:address,
    // })
    // room.save();
    const invite = new Invite({
      sender_id:sender_id,
      
    })
    invite.save();
    // const user = await Account.findByIdAndUpdate(req.params.id,{
    //   $addToSet: {invites: invite._id}
    // },{new:true,})
    // .select("-password -secret -secretQuestion -roommates -rentCollected -rentPaid -rent")

    res.send({success:true});
  } catch(err){
    _8b9‍.g.console.log(err);
  }
}